<div class="grid grid-nogutter">
    <div class="col-12 bg-color shadow-1">
        <div *ngIf="!loading">
            <div class="tabs-container m-3">
                <div (click)="currentTab = ProjectTabs.Tasks" class="tab"
                     [class.active]="currentTab === ProjectTabs.Tasks">
                    <i class="material-symbols-rounded">view_stream</i>
                    List
                </div>
                <div class="tab" (click)="currentTab = ProjectTabs.Members"
                     [class.active]="currentTab === ProjectTabs.Members">
                    <i class="material-symbols-rounded">group</i>
                    Members
                </div>
            </div>

            <div [ngSwitch]="currentTab">
                <div *ngSwitchCase="ProjectTabs.Tasks">
                    <div class="bg-secondary md:px-7 p-3 pb-0 flex flex-column gap-1">
                        <div class="flex align-items-center justify-content-between">
                            <span class="text-color font-bold text-lg">Tasks</span>

                            <button class="btn filled-btn" (click)="addTask()">
                                <span class="material-symbols-rounded">add</span>
                                New Task
                            </button>
                        </div>
                        <div class="tabs-container">
                            <div (click)="currentListTab = 'all'" class="tab underline"
                                 [class.active]="currentListTab === 'all'">
                                All
                            </div>
                            <div (click)="currentListTab = status.name" *ngFor="let status of statusList"
                                 class="tab underline"
                                 [class.active]="currentListTab === status.name">
                                {{ status.name }}
                            </div>
                        </div>
                    </div>

                    <button class="btn outlined-btn small-btn mt-3 mx-3 md:mx-7">
                        <span class="material-symbols-rounded">filter_alt</span>
                        Add Filters
                    </button>
                    <div class="flex flex-column md:px-7 pb-3 mt-3">
                        <div class="p-3" *ngIf="project.tasks.length === 0">
                            <div
                                class="p-3 gap-3 w-full flex flex-column surface-warning border-warning rounded">
                                <div class="flex align-items-center gap-2">
                                    <span class="material-symbols-rounded text-2xl">warning</span>
                                    <span class="text-color text-lg">No tasks found</span>
                                </div>

                                <span class="text-color text-sm">Click on the button above to add a new task</span>
                            </div>
                        </div>

                        <div *ngFor="let task of project.tasks; let i = index">
                            <app-card class="block mb-3" *ngIf="currentListTab === 'all' || task.status.name === currentListTab"
                                      [taskProject]="project" [task]="task" [index]="i"
                                      (updateKanban)="updateKanban()">
                            </app-card>
                        </div>
                    </div>
                </div>
                <div *ngSwitchCase="false">
                    <div cdkDropListGroup class="flex md:grid flex-column md:flex-row grid-nogutter gap-5 h-full">
                        <!-- COLUMNS -->
                        <div cdkDropList class="col-12 md:col column p-0 h-auto md:h-97 flex flex-column gap-3 p-2"
                             *ngFor="let status of statusList; let i = index" [cdkDropListData]="project.tasks"
                             (cdkDropListDropped)="drop($event)">
                            <header
                                class="p-3 md:p-0 mb-0 border-bottom-1 md:border-bottom-0 border-300 md:border-transparent">
                                <div class="left-container">
                                    <button class="btn text-btn small-btn" (click)="addTask(status.name)">
                                        <span class="material-symbols-rounded">add</span>
                                    </button>
                                    <span class="title text-color">{{ status.name }}</span>
                                    <span class="task-count">{{ getTasksOfStatus(status.name, project) }}</span>
                                </div>
                            </header>
                            <div class="dropzone">
                                <i class="material-symbols-rounded text-2xl">arrow_drop_down_circle</i>
                            </div>
                            <!-- CARDS -->
                            <div class="grid grid-nogutter gap-3 max-h-30rem md:max-h-30rem h-auto overflow-y-auto">
                                <div *ngFor="let task of project.tasks; let i = index">
                                    <app-card class="col-12 drag-box"
                                              *ngIf="task.status.name === status.name" [taskProject]="project"
                                              [task]="task" [index]="i"
                                              (updateKanban)="updateKanban()">
                                    </app-card>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div *ngSwitchCase="ProjectTabs.Timeline" class="h-full">
                    <app-kanban-timeline [projectId]="projectId" class="h-full"></app-kanban-timeline>
                </div>-->
                <div *ngSwitchCase="ProjectTabs.Members" class="h-full">
                    <app-project-members [owner]="project.owner" [isUserOwner]="project.owner.uid === user.uid" [members]="project.members"
                                         (onChangeSubmit)="updateFromMembers($event)" class="h-full"></app-project-members>
                </div>
            </div>
        </div>
    </div>
</div>
